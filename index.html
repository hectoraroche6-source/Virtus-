<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VIRTUD PRO ULTIMATE</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #00f2ff;
    --bg: #050a10;
    --panel-bg: #0f1219;
    --text: #ffffff;
    --accent: #ff0055;
    --success: #00ff88;
}

* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; padding-bottom: 80px; }
h1, h2, h3 { font-family: 'Orbitron', sans-serif; margin: 0; }

/* --- UTILIDADES --- */
.hidden { display: none !important; }
.btn { border: none; padding: 10px 15px; cursor: pointer; font-family: 'Orbitron', sans-serif; font-weight: bold; text-transform: uppercase; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); transition: 0.2s; }
.btn-main { background: var(--primary); color: #000; width: 100%; margin-bottom: 10px; }
.btn-main:active { transform: scale(0.95); }
.btn-danger { background: var(--accent); color: white; width: 100%; }
input, select, textarea { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #333; padding: 12px; color: white; margin-bottom: 10px; font-family: 'Rajdhani', sans-serif; font-size: 1rem; }
input[type="file"] { padding: 5px; }

/* --- PORTADA MEJORADA (CLAMP) --- */
#landing {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    background-size: cover; background-position: center; z-index: 2000;
}
.landing-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); z-index: 1; }
.landing-content { position: relative; z-index: 2; text-align: center; padding: 20px; width: 95%; }

/* TITULO INTELIGENTE */
#landingTitle { 
    font-size: clamp(2rem, 10vw, 4rem); 
    line-height: 1.1;
    word-wrap: break-word;
    max-width: 100%;
    text-shadow: 0 0 20px var(--primary); 
    margin-bottom: 30px; 
}

/* ANIMACIONES */
.anim-pulse { animation: pulse 2s infinite; }
.anim-bounce { animation: bounce 2s infinite; }
.anim-shake { animation: shake 3s infinite; }
@keyframes pulse { 0% {transform:scale(1);} 50% {transform:scale(1.05);} 100% {transform:scale(1);} }
@keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
@keyframes shake { 0% {transform: translateX(0);} 10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);} 20%, 40%, 60%, 80% {transform: translateX(5px);} 100% {transform: translateX(0);} }

/* ESTILOS DE BOTONES */
.btn-neon-blue { background: linear-gradient(45deg, #00f2ff, #0044ff); color: white; box-shadow: 0 0 15px #00f2ff; }
.btn-neon-red { background: linear-gradient(45deg, #ff0055, #ff0000); color: white; box-shadow: 0 0 15px #ff0055; }
.btn-neon-green { background: linear-gradient(45deg, #00ff88, #00cc44); color: black; box-shadow: 0 0 15px #00ff88; }
.btn-neon-purple { background: linear-gradient(45deg, #aa00ff, #ff00cc); color: white; box-shadow: 0 0 15px #aa00ff; }
.btn-neon-gold { background: linear-gradient(45deg, #ffd700, #ffaa00); color: black; box-shadow: 0 0 15px #ffd700; }
.btn-neon-white { background: linear-gradient(45deg, #ffffff, #aaaaaa); color: black; box-shadow: 0 0 15px #ffffff; }
.btn-matte-black { background: #111; border: 1px solid #333; color: white; }
.btn-matte-grey { background: #444; color: white; }
.btn-matte-blue { background: #004488; color: white; }
.btn-matte-red { background: #880022; color: white; }
.btn-matte-green { background: #005522; color: white; }

/* --- APP PRINCIPAL --- */
header { background: rgba(0,0,0,0.9); padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; text-align: center; }
.subtitle { font-size: 0.9rem; color: #aaa; margin-top: 5px; }

/* Animaciones Subt√≠tulo */
.sub-fade { animation: fadeIO 3s infinite; }
.sub-slide { animation: slideIn 3s infinite; }
.sub-glitch { text-shadow: 2px 0 red, -2px 0 blue; }
.sub-neon { text-shadow: 0 0 10px var(--primary); }
.sub-type { border-right: 2px solid var(--primary); overflow: hidden; white-space: nowrap; animation: typing 4s steps(40) infinite; margin: 0 auto; display: inline-block;}
@keyframes fadeIO { 0%,100%{opacity:0.3} 50%{opacity:1} }
@keyframes typing { from{width:0} to{width:100%} }

/* --- SECCIONES HORIZONTALES --- */
.sections-nav {
    display: flex; overflow-x: auto; gap: 10px; padding: 15px; background: #0a0f1f;
    position: sticky; top: 75px; z-index: 90; scrollbar-width: none;
}
.sections-nav::-webkit-scrollbar { display: none; }

.section-tab {
    background: #1c2541; padding: 10px 20px; border-radius: 20px; white-space: nowrap;
    color: #888; border: 1px solid #333; transition: 0.3s; font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem; cursor: pointer;
}

.section-tab.active {
    background: var(--primary); color: black; font-weight: bold; border: 2px solid white;
    box-shadow: 0 0 15px rgba(255,255,255,0.8); transform: scale(1.05);
}

/* --- GRID PRODUCTOS --- */
.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; padding-top: 20px; }
.card { background: #151a25; border-radius: 8px; overflow: hidden; position: relative; border: 1px solid #333; transition: 0.3s; }
.card img { width: 100%; height: 120px; object-fit: cover; }
.card-content { padding: 10px; }
.card h4 { font-size: 0.9rem; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card .price { color: var(--success); font-weight: bold; font-size: 1.1rem; }
.featured-tag { position: absolute; top: 0; left: 0; background: var(--accent); color: white; padding: 2px 8px; font-size: 0.7rem; font-weight: bold; }

/* --- ANIMACION FLECHA MEJORADA (GLOW + 1.2s) --- */
.flying-arrow {
    position: fixed; z-index: 9999; font-size: 2.2rem; color: #00f2ff;
    pointer-events: none;
    text-shadow: 0 0 15px #00f2ff, 0 0 30px #00f2ff; /* Glow Neon */
    filter: drop-shadow(0 0 5px white);
    transition: all 1.2s cubic-bezier(0.19, 1, 0.22, 1);
}

/* --- CARRITO MODAL COMPLETO --- */
#cartModal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000;
    padding: 20px; display: flex; flex-direction: column;
}
.cart-item { display: flex; justify-content: space-between; align-items: center; background: #111; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #333; }
.qty-btn { background: var(--primary); border: none; width: 30px; height: 30px; font-weight: bold; cursor: pointer; border-radius: 4px; }
.cart-footer { border-top: 2px solid #333; padding-top: 20px; background: #050a10; margin-top: auto; }

/* --- PANEL ADMIN --- */
#adminPanel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; overflow-y: auto; display: flex; flex-direction: column; }
.admin-header { background: #111; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 10; }
.admin-controls { display: flex; gap: 10px; }
.admin-body { padding: 20px; flex: 1; }
.dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.dash-btn { background: #1c2541; padding: 20px; text-align: center; border-radius: 10px; border: 1px solid #333; cursor: pointer; transition: 0.3s; }
.dash-btn:hover { border-color: var(--primary); background: #222; }
.dash-icon { font-size: 2rem; display: block; margin-bottom: 10px; }
.admin-section { animation: fadeIn 0.3s; }
.list-item { background: #222; padding: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; }
.fab-admin { position: fixed; right: 20px; top: 20px; background: rgba(0,0,0,0.5); color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid #555; z-index: 500; cursor: pointer; }
.fab-cart { position: fixed; right: 20px; bottom: 20px; background: var(--primary); color: black; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 0 20px var(--primary); z-index: 400; font-weight: bold; transition: 0.2s;}

@keyframes fadeIn { from{opacity:0; transform: translateY(10px);} to{opacity:1; transform: translateY(0);} }
</style>
</head>
<body>

<div id="landing">
    <div class="landing-overlay"></div>
    <div class="landing-content">
        <h1 id="landingTitle">VIRTUD</h1>
        <button id="landingBtn" class="btn btn-neon-blue anim-pulse" style="padding: 15px 50px; font-size: 1.2rem;" onclick="enterSite()">ENTRAR</button>
    </div>
</div>

<div class="fab-admin" onclick="openAdmin()" id="adminTrigger" style="display:none;">‚öôÔ∏è</div>

<div id="app" class="hidden">
    <header>
        <h2 id="appTitle">VIRTUD STORE</h2>
        <div id="appSubtitle" class="subtitle sub-fade">Bienvenido</div>
    </header>

    <div style="padding: 15px;">
        <input type="text" id="mainSearch" placeholder="Buscar..." onkeyup="searchEngine(this.value)">
    </div>

    <div id="sectionsNav" class="sections-nav"></div>
    <div id="contentArea"></div>
</div>

<div class="fab-cart" id="cartBtn" style="display:none;" onclick="toggleCart()">0</div>

<div id="cartModal" class="hidden">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
        <h3 style="color:var(--primary)">TU PEDIDO</h3>
        <button onclick="toggleCart()" style="background:none; color:white; border:none; font-size:1.5rem;">‚úï</button>
    </div>
    <div id="cartItemsList" style="flex:1; overflow-y:auto; padding-right:5px;"></div>
    
    <div class="cart-footer">
        <h3 style="display:flex; justify-content:space-between;">
            <span>TOTAL:</span> 
            <span id="cartTotalDisplay" style="color:var(--success)">$0.00</span>
        </h3>
        <button id="btnMakeOrder" class="btn btn-main" style="margin-top:10px; height:60px; font-size:1.2rem;">HACER PEDIDO</button>
    </div>
</div>

<div id="adminPanel" class="hidden">
    <div class="admin-header">
        <div style="display: flex; align-items: center; gap: 10px;">
            <button onclick="adminBack()" id="adminBackBtn" class="hidden">‚¨Ö Atr√°s</button>
            <h3 style="color:var(--primary)">PANEL DE CONTROL</h3>
        </div>
        <div class="admin-controls">
            <button onclick="minimizeAdmin()">_</button>
            <button onclick="closeAdmin(true)" style="background:var(--accent)">‚úñ</button>
        </div>
    </div>

    <div class="admin-body">
        
        <div id="adminDashboard" class="admin-section">
            <div class="dashboard-grid">
                <div class="dash-btn" onclick="navTo('screenProducts')">
                    <span class="dash-icon">üì¶</span>
                    Productos e Inventario
                </div>
                <div class="dash-btn" onclick="navTo('screenSections')">
                    <span class="dash-icon">üìë</span>
                    Gestionar Secciones
                </div>
                <div class="dash-btn" onclick="navTo('screenCover')">
                    <span class="dash-icon">üé®</span>
                    Personalizar Portada
                </div>
                <div class="dash-btn" onclick="navTo('screenConfig')">
                    <span class="dash-icon">‚öôÔ∏è</span>
                    Configuraciones
                </div>
            </div>
            <br>
            <div style="background:#222; padding:15px; border-radius:8px;">
                <h4>Resumen</h4>
                <p>Productos: <span id="statProd">0</span></p>
                <p>Secciones: <span id="statSec">0</span></p>
            </div>
        </div>

        <div id="screenSections" class="admin-section hidden">
            <h4>Mis Secciones</h4>
            <div style="display:flex; gap:5px;">
                <input id="newSectionName" placeholder="Nueva Secci√≥n">
                <button class="btn btn-main" style="width:auto;" onclick="addSection()">+</button>
            </div>
            <div id="sectionListContainer"></div>
        </div>

        <div id="screenProducts" class="admin-section hidden">
            <h4>Nuevo Producto</h4>
            <select id="prodSectionSelect"></select>
            <input type="file" id="prodImgInput" accept="image/*">
            <input id="prodName" placeholder="Nombre del Producto">
            <div style="display:flex; gap:10px;">
                <input id="prodPrice" type="number" placeholder="Precio">
                <input id="prodCurrency" placeholder="Moneda" value="CUP">
            </div>
            <textarea id="prodDesc" rows="3" placeholder="Descripci√≥n..."></textarea>
            
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                <input type="checkbox" id="prodFeatured" style="width:20px;"> 
                <label for="prodFeatured">Destacar</label>
            </div>
            <button class="btn btn-main" onclick="saveProduct()">GUARDAR PRODUCTO</button>

            <hr style="border-color:#333; margin:20px 0;">
            <h4 style="color:var(--primary)">Inventario Completo (Eliminar)</h4>
            <div id="fullInventoryList"></div>
        </div>

        <div id="screenCover" class="admin-section hidden">
            <h4>Personalizar Portada</h4>
            <input id="cfgLandTitle" placeholder="Ej: VIRTUD">
            <input type="file" id="cfgLandImg" accept="image/*">
            <button class="btn btn-danger" onclick="clearCoverImg()" style="margin-bottom:10px;">Quitar Fondo</button>
            <input id="cfgBtnText" placeholder="Texto del bot√≥n">
            <select id="cfgBtnStyle">
                <option value="btn-neon-blue">Azul Cyber</option>
                <option value="btn-neon-red">Rojo Fuego</option>
                <option value="btn-neon-green">Verde Hacker</option>
                <option value="btn-matte-black">Negro Profundo</option>
            </select>
            <button class="btn btn-main" onclick="saveCoverConfig()">APLICAR CAMBIOS</button>
        </div>

        <div id="screenConfig" class="admin-section hidden">
            <h4>Configuraci√≥n General</h4>
            <label>Bot√≥n del Carrito</label>
            <input id="cfgOrderBtnText" placeholder="Ej: ENVIAR WHATSAPP">
            <label>Placeholder Buscador</label>
            <input id="cfgSearchText">
            <label>Subt√≠tulo App</label>
            <input id="cfgAppSub">
            <button class="btn btn-main" onclick="saveGeneralConfig()">GUARDAR CONFIG</button>
        </div>
    </div>
</div>

<script>
/* --- BASE DE DATOS --- */
const defaultDB = {
    config: {
        landingTitle: "VIRTUD",
        landingBtnText: "ENTRAR",
        landingBtnStyle: "btn-neon-blue",
        landingBg: null,
        appTitle: "VIRTUD STORE",
        appSubtitle: "Bienvenido",
        searchPlaceholder: "Buscar...",
        orderBtnText: "HACER PEDIDO"
    },
    sections: ["Combos", "Aseo"],
    products: []
};

let db = JSON.parse(localStorage.getItem('virtud_db')) || defaultDB;
let activeSection = db.sections[0] || "";
let cart = []; // ARRAY CARRITO

/* --- INICIO --- */
function init() {
    applyConfig();
    if(localStorage.getItem('isAdmin') === 'true'){
        document.getElementById('adminTrigger').style.display = 'flex';
    }
}

function enterSite() {
    document.getElementById('landing').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('cartBtn').style.display = 'flex';
    document.getElementById('adminTrigger').style.display = 'flex';
    renderNav();
    renderContent();
}

function applyConfig() {
    const c = db.config;
    document.getElementById('landingTitle').innerText = c.landingTitle;
    const lBtn = document.getElementById('landingBtn');
    lBtn.innerText = c.landingBtnText;
    lBtn.className = `btn ${c.landingBtnStyle} anim-pulse`;
    if(c.landingBg) document.getElementById('landing').style.backgroundImage = `url(${c.landingBg})`;
    
    document.getElementById('appTitle').innerText = c.appTitle;
    document.getElementById('appSubtitle').innerText = c.appSubtitle;
    document.getElementById('mainSearch').placeholder = c.searchPlaceholder || "Buscar...";
    document.getElementById('btnMakeOrder').innerText = c.orderBtnText || "HACER PEDIDO";
}

/* --- RENDERIZADO --- */
function renderNav() {
    const nav = document.getElementById('sectionsNav');
    nav.innerHTML = "";
    if(db.sections.length === 0) { nav.innerHTML = "<span style='color:white; padding:10px;'>Sin secciones</span>"; return; }
    if(!db.sections.includes(activeSection) && db.sections.length > 0) activeSection = db.sections[0];

    db.sections.forEach(sec => {
        const tab = document.createElement('div');
        tab.className = `section-tab ${sec === activeSection ? 'active' : ''}`;
        tab.innerText = sec;
        tab.onclick = () => { activeSection = sec; renderNav(); renderContent(); };
        nav.appendChild(tab);
    });
}

function renderContent() {
    const area = document.getElementById('contentArea');
    area.innerHTML = "";
    const prods = db.products.filter(p => p.section === activeSection);
    
    if(prods.length === 0) {
        area.innerHTML = `<div style="text-align:center; padding:40px; color:#555;">No hay productos en ${activeSection}</div>`;
        return;
    }

    const grid = document.createElement('div');
    grid.className = 'grid';
    prods.sort((a,b) => (b.featured ? 1 : 0) - (a.featured ? 1 : 0));

    prods.forEach(p => {
        grid.innerHTML += `
        <div class="card">
            ${p.featured ? '<span class="featured-tag">‚òÖ</span>' : ''}
            <img src="${p.image || ''}">
            <div class="card-content">
                <h4>${p.name}</h4>
                <div class="price">$${p.price} <small>${p.currency}</small></div>
                <button class="btn btn-main" style="margin-top:5px; font-size:0.8rem;" onclick="addToCart(event, '${p.id}')">AGREGAR</button>
            </div>
        </div>`;
    });
    area.appendChild(grid);
}

/* --- SONIDO Y FLECHA --- */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playChiquin() {
    // CORRECCI√ìN: Resumir audio context si est√° suspendido
    if (audioCtx.state === 'suspended') audioCtx.resume();
    
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    
    osc.frequency.setValueAtTime(1500, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(500, audioCtx.currentTime + 0.2);
    
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
    
    osc.start(); osc.stop(audioCtx.currentTime + 0.2);
}

function addToCart(e, id) {
    playChiquin();

    // 1. L√≥gica Carrito Real
    const prod = db.products.find(p => p.id === id);
    const existing = cart.find(item => item.id === id);
    if(existing) existing.qty++; else cart.push({...prod, qty: 1});
    updateCartUI();

    // 2. Animaci√≥n Flecha Mejorada (1.2s)
    const rect = e.target.getBoundingClientRect();
    const cRect = document.getElementById('cartBtn').getBoundingClientRect();
    const arrow = document.createElement('div');
    arrow.className = 'flying-arrow';
    arrow.innerHTML = '‚û§';
    arrow.style.left = rect.left + 'px'; arrow.style.top = rect.top + 'px';
    document.body.appendChild(arrow);
    
    setTimeout(() => { 
        arrow.style.left = (cRect.left + 10) + 'px'; 
        arrow.style.top = (cRect.top + 10) + 'px'; 
        arrow.style.opacity = '0';
        arrow.style.transform = 'scale(0.5) rotate(-45deg)';
    }, 50);
    setTimeout(() => arrow.remove(), 1250);
}

/* --- L√ìGICA DE CARRITO Y TOTALES --- */
function updateCartUI() {
    // Actualizar burbuja flotante
    const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
    document.getElementById('cartBtn').innerText = totalQty;
    
    // Actualizar lista modal
    const list = document.getElementById('cartItemsList');
    let totalMoney = 0;
    
    list.innerHTML = cart.map(item => {
        totalMoney += item.price * item.qty;
        return `<div class="cart-item">
            <div style="flex:1">
                <b>${item.name}</b><br>
                <span style="color:var(--success)">$${(item.price * item.qty).toFixed(2)}</span>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="qty-btn" onclick="changeQty('${item.id}', -1)">-</button>
                <span style="min-width:20px; text-align:center;">${item.qty}</span>
                <button class="qty-btn" onclick="changeQty('${item.id}', 1)">+</button>
                <button onclick="changeQty('${item.id}', -999)" style="background:none; border:none; color:red; margin-left:5px;">‚úï</button>
            </div>
        </div>`;
    }).join('');
    
    document.getElementById('cartTotalDisplay').innerText = `$${totalMoney.toFixed(2)}`;
}

function changeQty(id, delta) {
    const item = cart.find(i => i.id === id);
    if (delta === -999) {
        cart = cart.filter(i => i.id !== id);
    } else {
        item.qty += delta;
        if(item.qty <= 0) cart = cart.filter(i => i.id !== id);
    }
    updateCartUI();
}
function toggleCart() { document.getElementById('cartModal').classList.toggle('hidden'); }

/* --- BUSCADOR ESTRICTO --- */
function searchEngine(text) {
    const area = document.getElementById('contentArea');
    const nav = document.getElementById('sectionsNav');
    const term = text.toLowerCase();
    
    // Si est√° vac√≠o, resetear vista
    if(term === "") {
        nav.classList.remove('hidden');
        renderContent();
        return;
    }

    // Ocultar tabs de secciones
    nav.classList.add('hidden');

    const results = db.products.filter(p => p.name.toLowerCase().includes(term));

    if(results.length === 0) {
        area.innerHTML = `<div style="padding:60px; text-align:center; color:#888;">
            <h4>Ese producto no se encuentra disponible.</h4>
        </div>`;
        return;
    }

    const grid = document.createElement('div');
    grid.className = 'grid';
    results.forEach(p => {
        grid.innerHTML += `
        <div class="card">
            <img src="${p.image || ''}">
            <div class="card-content">
                <h4>${p.name}</h4>
                <div class="price">$${p.price}</div>
                <button class="btn btn-main" onclick="addToCart(event, '${p.id}')">AGREGAR</button>
            </div>
        </div>`;
    });
    area.innerHTML = "";
    area.appendChild(grid);
}

/* --- ADMIN --- */
function openAdmin() {
    if(localStorage.getItem('isAdmin') === 'true'){
        document.getElementById('adminPanel').classList.remove('hidden');
        updateDashboardStats();
        return;
    }
    const pass = prompt("Contrase√±a Admin:");
    if(pass === "separabit2020") {
        localStorage.setItem('isAdmin', 'true');
        document.getElementById('adminPanel').classList.remove('hidden');
        updateDashboardStats();
    }
}
function minimizeAdmin() { document.getElementById('adminPanel').classList.add('hidden'); }
function closeAdmin(logout) {
    document.getElementById('adminPanel').classList.add('hidden');
    if(logout) { localStorage.removeItem('isAdmin'); location.reload(); }
}

function navTo(screenId) {
    document.querySelectorAll('.admin-section').forEach(el => el.classList.add('hidden'));
    document.getElementById(screenId).classList.remove('hidden');
    document.getElementById('adminDashboard').classList.add('hidden'); 
    document.getElementById('adminBackBtn').classList.remove('hidden');
    if(screenId === 'screenProducts') { renderSectionSelect(); renderFullInventory(); }
    if(screenId === 'screenSections') renderAdminSections();
    if(screenId === 'screenCover') loadCoverValues();
    if(screenId === 'screenConfig') loadConfigValues();
}

function adminBack() {
    document.querySelectorAll('.admin-section').forEach(el => el.classList.add('hidden'));
    document.getElementById('adminDashboard').classList.remove('hidden');
    document.getElementById('adminBackBtn').classList.add('hidden');
    updateDashboardStats();
}

function updateDashboardStats() {
    document.getElementById('statProd').innerText = db.products.length;
    document.getElementById('statSec').innerText = db.sections.length;
}

/* --- GESTI√ìN PRODUCTOS E INVENTARIO --- */
function renderSectionSelect() {
    const sel = document.getElementById('prodSectionSelect');
    sel.innerHTML = db.sections.map(s => `<option value="${s}">${s}</option>`).join('');
}
function saveProduct() {
    const name = document.getElementById('prodName').value;
    const price = document.getElementById('prodPrice').value;
    const sec = document.getElementById('prodSectionSelect').value;
    const fileInput = document.getElementById('prodImgInput');
    
    if(!name || !price) return alert("Faltan datos");

    const newProd = { 
        id: Date.now().toString(), 
        name, 
        price: parseFloat(price), 
        currency: document.getElementById('prodCurrency').value, 
        section: sec, 
        featured: document.getElementById('prodFeatured').checked, 
        image: null 
    };

    if(fileInput.files && fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            newProd.image = e.target.result;
            db.products.push(newProd); saveDB(); renderFullInventory(); alert("Guardado");
        };
        reader.readAsDataURL(fileInput.files[0]);
    } else { db.products.push(newProd); saveDB(); renderFullInventory(); alert("Guardado"); }
}

// INVENTARIO COMPLETO CON BORRADO
function renderFullInventory() {
    const div = document.getElementById('fullInventoryList');
    div.innerHTML = "";
    db.products.forEach(p => {
        div.innerHTML += `
        <div class="list-item">
            <span>${p.name} ($${p.price})</span>
            <button onclick="deleteProduct('${p.id}')" style="background:var(--accent); color:white; border:none; padding:5px 10px; border-radius:4px;">BORRAR</button>
        </div>`;
    });
}
function deleteProduct(id) {
    if(confirm("¬øEliminar este producto?")) {
        db.products = db.products.filter(p => p.id !== id);
        saveDB(); renderFullInventory();
    }
}

/* --- SECCIONES --- */
function renderAdminSections() {
    const list = document.getElementById('sectionListContainer');
    list.innerHTML = db.sections.map((sec, i) => `
        <div class="list-item">
            <span>${sec}</span>
            <button onclick="deleteSection(${i})" style="color:red; background:none; border:none;">‚úñ</button>
        </div>`).join('');
}
function addSection() {
    const name = document.getElementById('newSectionName').value;
    if(name) { db.sections.push(name); saveDB(); renderAdminSections(); document.getElementById('newSectionName').value=""; }
}
function deleteSection(i) {
    if(confirm("¬øBorrar secci√≥n?")) { db.sections.splice(i, 1); saveDB(); renderAdminSections(); }
}

/* --- CONFIGURACIONES --- */
function loadCoverValues() {
    const c = db.config;
    document.getElementById('cfgLandTitle').value = c.landingTitle;
    document.getElementById('cfgBtnText').value = c.landingBtnText;
    document.getElementById('cfgBtnStyle').value = c.landingBtnStyle;
}
function saveCoverConfig() {
    db.config.landingTitle = document.getElementById('cfgLandTitle').value;
    db.config.landingBtnText = document.getElementById('cfgBtnText').value;
    db.config.landingBtnStyle = document.getElementById('cfgBtnStyle').value;
    const file = document.getElementById('cfgLandImg');
    if(file.files[0]) {
        const reader = new FileReader();
        reader.onload = (e) => { db.config.landingBg = e.target.result; saveDB(); location.reload(); };
        reader.readAsDataURL(file.files[0]);
    } else { saveDB(); location.reload(); }
}
function clearCoverImg() { db.config.landingBg = null; saveDB(); alert("Fondo quitado"); }

function loadConfigValues() {
    document.getElementById('cfgOrderBtnText').value = db.config.orderBtnText || "";
    document.getElementById('cfgSearchText').value = db.config.searchPlaceholder || "";
    document.getElementById('cfgAppSub').value = db.config.appSubtitle || "";
}
function saveGeneralConfig() {
    db.config.orderBtnText = document.getElementById('cfgOrderBtnText').value;
    db.config.searchPlaceholder = document.getElementById('cfgSearchText').value;
    db.config.appSubtitle = document.getElementById('cfgAppSub').value;
    saveDB(); location.reload();
}

function saveDB() { localStorage.setItem('virtud_db', JSON.stringify(db)); }

init();
</script>
</body>
</html>
