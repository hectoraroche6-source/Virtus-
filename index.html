<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VIRTUD PRO ADMIN V3.5</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #00f2ff;
    --bg: #050a10;
    --panel-bg: #0f1219;
    --text: #ffffff;
    --accent: #ff0055;
    --success: #00ff88;
}

* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; padding-bottom: 80px; }
h1, h2, h3 { font-family: 'Orbitron', sans-serif; margin: 0; }

/* --- UTILIDADES --- */
.hidden { display: none !important; }
.btn { border: none; padding: 10px 15px; cursor: pointer; font-family: 'Orbitron', sans-serif; font-weight: bold; text-transform: uppercase; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); transition: 0.2s; }
.btn-main { background: var(--primary); color: #000; width: 100%; margin-bottom: 10px; }
.btn-main:active { transform: scale(0.95); }
.btn-danger { background: var(--accent); color: white; width: 100%; }
input, select, textarea { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #333; padding: 12px; color: white; margin-bottom: 10px; font-family: 'Rajdhani', sans-serif; font-size: 1rem; }
input[type="file"] { padding: 5px; }

/* --- PORTADA --- */
#landing {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    background-size: cover; background-position: center; z-index: 2000;
}
.landing-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); z-index: 1; }
.landing-content { position: relative; z-index: 2; text-align: center; padding: 20px; }
#landingTitle { font-size: 3.5rem; letter-spacing: 5px; text-shadow: 0 0 20px var(--primary); margin-bottom: 20px; }

/* ANIMACIONES */
.anim-pulse { animation: pulse 2s infinite; }
.anim-bounce { animation: bounce 2s infinite; }
.anim-shake { animation: shake 3s infinite; }
@keyframes pulse { 0% {transform:scale(1);} 50% {transform:scale(1.05);} 100% {transform:scale(1);} }
@keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-10px);} 60% {transform: translateY(-5px);} }
@keyframes shake { 0% {transform: translateX(0);} 10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);} 20%, 40%, 60%, 80% {transform: translateX(5px);} 100% {transform: translateX(0);} }

/* ESTILOS DE BOTONES (EXPANDIDO) */
/* Neones */
.btn-neon-blue { background: linear-gradient(45deg, #00f2ff, #0044ff); color: white; box-shadow: 0 0 15px #00f2ff; }
.btn-neon-red { background: linear-gradient(45deg, #ff0055, #ff0000); color: white; box-shadow: 0 0 15px #ff0055; }
.btn-neon-green { background: linear-gradient(45deg, #00ff88, #00cc44); color: black; box-shadow: 0 0 15px #00ff88; }
.btn-neon-purple { background: linear-gradient(45deg, #aa00ff, #ff00cc); color: white; box-shadow: 0 0 15px #aa00ff; }
.btn-neon-gold { background: linear-gradient(45deg, #ffd700, #ffaa00); color: black; box-shadow: 0 0 15px #ffd700; }
.btn-neon-white { background: linear-gradient(45deg, #ffffff, #aaaaaa); color: black; box-shadow: 0 0 15px #ffffff; }
/* Mates */
.btn-matte-black { background: #111; border: 1px solid #333; color: white; }
.btn-matte-grey { background: #444; color: white; }
.btn-matte-blue { background: #004488; color: white; }
.btn-matte-red { background: #880022; color: white; }
.btn-matte-green { background: #005522; color: white; }

/* --- APP PRINCIPAL --- */
header { background: rgba(0,0,0,0.9); padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; text-align: center; }
.subtitle { font-size: 0.9rem; color: #aaa; margin-top: 5px; }

/* Animaciones Subt√≠tulo */
.sub-fade { animation: fadeIO 3s infinite; }
.sub-slide { animation: slideIn 3s infinite; }
.sub-glitch { text-shadow: 2px 0 red, -2px 0 blue; }
.sub-neon { text-shadow: 0 0 10px var(--primary); }
.sub-type { border-right: 2px solid var(--primary); overflow: hidden; white-space: nowrap; animation: typing 4s steps(40) infinite; margin: 0 auto; display: inline-block;}
@keyframes fadeIO { 0%,100%{opacity:0.3} 50%{opacity:1} }
@keyframes typing { from{width:0} to{width:100%} }

/* --- SECCIONES HORIZONTALES (NUEVO) --- */
.sections-nav {
    display: flex;
    overflow-x: auto;
    gap: 10px;
    padding: 15px;
    background: #0a0f1f;
    position: sticky;
    top: 75px; /* Ajuste seg√∫n header */
    z-index: 90;
    scrollbar-width: none; /* Firefox */
}
.sections-nav::-webkit-scrollbar { display: none; } /* Chrome */

.section-tab {
    background: #1c2541;
    padding: 10px 20px;
    border-radius: 20px;
    white-space: nowrap;
    color: #888;
    border: 1px solid #333;
    transition: 0.3s;
    font-family: 'Orbitron', sans-serif;
    font-size: 0.9rem;
    cursor: pointer;
}

.section-tab.active {
    background: var(--primary);
    color: black;
    font-weight: bold;
    border: 2px solid white;
    box-shadow: 0 0 15px rgba(255,255,255,0.8);
    transform: scale(1.05);
}

/* --- GRID PRODUCTOS --- */
.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; padding-top: 20px; }
.card { background: #151a25; border-radius: 8px; overflow: hidden; position: relative; border: 1px solid #333; transition: 0.3s; }
.card img { width: 100%; height: 120px; object-fit: cover; }
.card-content { padding: 10px; }
.card h4 { font-size: 0.9rem; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.card .price { color: var(--success); font-weight: bold; font-size: 1.1rem; }
.featured-tag { position: absolute; top: 0; left: 0; background: var(--accent); color: white; padding: 2px 8px; font-size: 0.7rem; font-weight: bold; }

/* --- ANIMACION FLECHA AL CARRITO (NUEVO) --- */
.flying-arrow {
    position: fixed;
    z-index: 9999;
    font-size: 2rem;
    color: #00f2ff;
    text-shadow: 0 0 10px #00ff88;
    pointer-events: none;
    transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
}

/* --- PANEL ADMIN --- */
#adminPanel { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; overflow-y: auto; display: flex; flex-direction: column; }
.admin-header { background: #111; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--primary); position: sticky; top: 0; z-index: 10; }
.admin-controls { display: flex; gap: 10px; }
.admin-body { padding: 20px; flex: 1; }
.dashboard-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.dash-btn { background: #1c2541; padding: 20px; text-align: center; border-radius: 10px; border: 1px solid #333; cursor: pointer; transition: 0.3s; }
.dash-btn:hover { border-color: var(--primary); background: #222; }
.dash-icon { font-size: 2rem; display: block; margin-bottom: 10px; }
.admin-section { animation: fadeIn 0.3s; }
.list-item { background: #222; padding: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; }
.fab-admin { position: fixed; right: 20px; top: 20px; background: rgba(0,0,0,0.5); color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid #555; z-index: 500; cursor: pointer; }
.fab-cart { position: fixed; right: 20px; bottom: 20px; background: var(--primary); color: black; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; box-shadow: 0 0 20px var(--primary); z-index: 400; font-weight: bold; transition: 0.2s;}

@keyframes fadeIn { from{opacity:0; transform: translateY(10px);} to{opacity:1; transform: translateY(0);} }

</style>
</head>
<body>

<div id="landing">
    <div class="landing-overlay"></div>
    <div class="landing-content">
        <h1 id="landingTitle">VIRTUD</h1>
        <button id="landingBtn" class="btn btn-neon-blue anim-pulse" style="padding: 15px 50px; font-size: 1.2rem;" onclick="enterSite()">ENTRAR</button>
    </div>
</div>

<div class="fab-admin" onclick="openAdmin()" id="adminTrigger" style="display:none;">‚öôÔ∏è</div>

<div id="app" class="hidden">
    <header>
        <h2 id="appTitle">VIRTUD STORE</h2>
        <div id="appSubtitle" class="subtitle sub-fade">Bienvenido</div>
    </header>

    <div style="padding: 15px;">
        <input type="text" id="mainSearch" placeholder="Buscar..." onkeyup="searchEngine(this.value)">
    </div>

    <div id="sectionsNav" class="sections-nav"></div>

    <div id="contentArea"></div>
</div>

<div class="fab-cart" id="cartBtn" style="display:none;">0</div>

<div id="adminPanel" class="hidden">
    <div class="admin-header">
        <div style="display: flex; align-items: center; gap: 10px;">
            <button onclick="adminBack()" id="adminBackBtn" class="hidden">‚¨Ö Atr√°s</button>
            <h3 style="color:var(--primary)">PANEL DE CONTROL</h3>
        </div>
        <div class="admin-controls">
            <button onclick="minimizeAdmin()">_ Minimizar</button>
            <button onclick="closeAdmin(true)" style="background:var(--accent)">‚úñ Salir</button>
        </div>
    </div>

    <div class="admin-body">
        
        <div id="adminDashboard" class="admin-section">
            <div class="dashboard-grid">
                <div class="dash-btn" onclick="navTo('screenProducts')">
                    <span class="dash-icon">üì¶</span>
                    Agregar Productos
                </div>
                <div class="dash-btn" onclick="navTo('screenSections')">
                    <span class="dash-icon">üìë</span>
                    Gestionar Secciones
                </div>
                <div class="dash-btn" onclick="navTo('screenCover')">
                    <span class="dash-icon">üé®</span>
                    Personalizar Portada
                </div>
                <div class="dash-btn" onclick="navTo('screenConfig')">
                    <span class="dash-icon">‚öôÔ∏è</span>
                    Configuraciones
                </div>
            </div>
            <br>
            <div style="background:#222; padding:15px; border-radius:8px;">
                <h4>Resumen</h4>
                <p>Productos: <span id="statProd">0</span></p>
                <p>Secciones: <span id="statSec">0</span></p>
            </div>
        </div>

        <div id="screenSections" class="admin-section hidden">
            <h4>Mis Secciones (Orden Horizontal)</h4>
            <div style="display:flex; gap:5px;">
                <input id="newSectionName" placeholder="Nueva Secci√≥n (ej. Tecnolog√≠a)">
                <button class="btn btn-main" style="width:auto;" onclick="addSection()">+</button>
            </div>
            <div id="sectionListContainer"></div>
        </div>

        <div id="screenProducts" class="admin-section hidden">
            <h4>Nuevo Producto</h4>
            
            <label>Secci√≥n Principal</label>
            <select id="prodSectionSelect"></select>

            <label>Foto (Opcional, m√°x 1)</label>
            <input type="file" id="prodImgInput" accept="image/*">

            <input id="prodName" placeholder="Nombre del Producto">
            <div style="display:flex; gap:10px;">
                <input id="prodPrice" type="number" placeholder="Precio">
                <input id="prodCurrency" placeholder="Moneda (CUP/USD)" value="CUP">
            </div>
            <textarea id="prodDesc" rows="3" placeholder="Descripci√≥n detallada..."></textarea>
            
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:15px;">
                <input type="checkbox" id="prodFeatured" style="width:20px;"> 
                <label for="prodFeatured">Destacar este producto</label>
            </div>

            <button class="btn btn-main" onclick="saveProduct()">GUARDAR PRODUCTO</button>

            <hr style="border-color:#333; margin:20px 0;">
            <h4>Lista R√°pida (√öltimos 5)</h4>
            <div id="productListMini"></div>
        </div>

        <div id="screenCover" class="admin-section hidden">
            <h4>Personalizar Portada</h4>
            
            <label>T√≠tulo Principal</label>
            <input id="cfgLandTitle" placeholder="Ej: VIRTUD">

            <label>Imagen de Fondo</label>
            <input type="file" id="cfgLandImg" accept="image/*">
            <button class="btn btn-danger" onclick="clearCoverImg()" style="margin-bottom:10px;">Quitar Fondo</button>

            <h4>Bot√≥n de Entrada</h4>
            <input id="cfgBtnText" placeholder="Texto del bot√≥n">
            
            <label>Color / Estilo (Mate y Neon)</label>
            <select id="cfgBtnStyle">
                <optgroup label="NEON (Luminoso)">
                    <option value="btn-neon-blue">Azul Cyber</option>
                    <option value="btn-neon-red">Rojo Fuego</option>
                    <option value="btn-neon-green">Verde Hacker</option>
                    <option value="btn-neon-purple">P√∫rpura Synth</option>
                    <option value="btn-neon-gold">Oro Brillante</option>
                    <option value="btn-neon-white">Blanco Puro</option>
                </optgroup>
                <optgroup label="MATE (S√≥lido)">
                    <option value="btn-matte-black">Negro Profundo</option>
                    <option value="btn-matte-grey">Gris Acero</option>
                    <option value="btn-matte-blue">Azul Marino</option>
                    <option value="btn-matte-red">Rojo Sangre</option>
                    <option value="btn-matte-green">Verde Militar</option>
                </optgroup>
            </select>

            <label>Animaci√≥n del Bot√≥n</label>
            <select id="cfgBtnAnim">
                <option value="anim-pulse">Pulso</option>
                <option value="anim-bounce">Rebote</option>
                <option value="anim-shake">Temblor</option>
            </select>

            <button class="btn btn-main" onclick="saveCoverConfig()">APLICAR CAMBIOS</button>
        </div>

        <div id="screenConfig" class="admin-section hidden">
            <h4>Configuraci√≥n General</h4>
            <label>Segundo T√≠tulo</label>
            <input id="cfgAppTitle">
            <label>Subt√≠tulo</label>
            <input id="cfgAppSub">
            <select id="cfgSubAnim">
                <option value="sub-fade">Desvanecer</option>
                <option value="sub-slide">Deslizar</option>
                <option value="sub-glitch">Glitch</option>
                <option value="sub-neon">Brillo Neon</option>
                <option value="sub-type">M√°quina de escribir</option>
            </select>
            <label>Texto Buscador</label>
            <input id="cfgSearchText">

            <button class="btn btn-main" onclick="saveGeneralConfig()">GUARDAR CONFIG</button>
        </div>
    </div>
</div>

<script>
/* --- BASE DE DATOS LOCAL --- */
const defaultDB = {
    config: {
        landingTitle: "VIRTUD",
        landingBtnText: "ENTRAR",
        landingBtnStyle: "btn-neon-blue",
        landingBtnAnim: "anim-pulse",
        landingBg: null,
        appTitle: "VIRTUD STORE",
        appSubtitle: "Bienvenido",
        subAnim: "sub-fade",
        searchPlaceholder: "Buscar productos..."
    },
    sections: ["Combos", "Aseo", "Tecnolog√≠a"],
    products: []
};

let db = JSON.parse(localStorage.getItem('virtud_db')) || defaultDB;
let activeSection = db.sections[0] || ""; // Secci√≥n activa por defecto

/* --- INICIO Y RENDERIZADO APP --- */
function init() {
    applyConfig();
    if(localStorage.getItem('isAdmin') === 'true'){
        document.getElementById('adminTrigger').style.display = 'flex';
    }
}

function enterSite() {
    document.getElementById('landing').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('cartBtn').style.display = 'flex';
    document.getElementById('adminTrigger').style.display = 'flex';
    renderNav();
    renderContent();
}

function applyConfig() {
    const c = db.config;
    document.getElementById('landingTitle').innerText = c.landingTitle;
    const lBtn = document.getElementById('landingBtn');
    lBtn.innerText = c.landingBtnText;
    lBtn.className = `btn ${c.landingBtnStyle} ${c.landingBtnAnim}`;
    if(c.landingBg) document.getElementById('landing').style.backgroundImage = `url(${c.landingBg})`;
    
    document.getElementById('appTitle').innerText = c.appTitle;
    const sub = document.getElementById('appSubtitle');
    sub.innerText = c.appSubtitle;
    sub.className = `subtitle ${c.subAnim}`;
    document.getElementById('mainSearch').placeholder = c.searchPlaceholder;
}

/* --- RENDERIZADO HORIZONTAL (NUEVO) --- */
function renderNav() {
    const nav = document.getElementById('sectionsNav');
    nav.innerHTML = "";
    
    // Si no hay secciones, crear una por defecto visualmente
    if(db.sections.length === 0) {
        nav.innerHTML = "<span style='color:white; padding:10px;'>Sin secciones</span>";
        return;
    }

    // Asegurar que activeSection existe
    if(!db.sections.includes(activeSection) && db.sections.length > 0) {
        activeSection = db.sections[0];
    }

    db.sections.forEach(sec => {
        const tab = document.createElement('div');
        tab.className = `section-tab ${sec === activeSection ? 'active' : ''}`;
        tab.innerText = sec;
        tab.onclick = () => {
            activeSection = sec;
            renderNav(); // Re-render para actualizar la clase activa
            renderContent(); // Actualizar productos
        };
        nav.appendChild(tab);
    });
}

function renderContent() {
    const area = document.getElementById('contentArea');
    area.innerHTML = "";

    // Filtrar productos de la secci√≥n activa
    const prods = db.products.filter(p => p.section === activeSection);
    
    // Grid
    const grid = document.createElement('div');
    grid.className = 'grid';
    
    if(prods.length === 0) {
        area.innerHTML = `<div style="text-align:center; padding:40px; color:#555;">No hay productos en ${activeSection}</div>`;
        return;
    }

    // Ordenar destacados
    prods.sort((a,b) => (b.featured ? 1 : 0) - (a.featured ? 1 : 0));

    prods.forEach(p => {
        const imgHTML = p.image ? `<img src="${p.image}">` : `<div style="height:120px; background:#222; display:flex; align-items:center; justify-content:center; color:#555;">Sin Foto</div>`;
        const featHTML = p.featured ? `<span class="featured-tag">‚òÖ DESTACADO</span>` : '';
        
        grid.innerHTML += `
        <div class="card">
            ${featHTML}
            ${imgHTML}
            <div class="card-content">
                <h4>${p.name}</h4>
                <div class="price">$${p.price} <small>${p.currency}</small></div>
                <button class="btn btn-main btn-add" style="margin-top:5px; font-size:0.8rem;" onclick="addToCart(event, '${p.id}')">AGREGAR</button>
            </div>
        </div>`;
    });
    area.appendChild(grid);
}

/* --- EFECTO DE COMPRA (NUEVO) --- */
// Generador de sonido sint√©tico (No requiere archivo externo)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playChiquinSound() {
    if (audioCtx.state === 'suspended') audioCtx.resume();
    
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    
    // Sonido tipo "Coin" o "Chiquin" (Frecuencia alta r√°pida)
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(1200, audioCtx.currentTime);
    oscillator.frequency.exponentialRampToValueAtTime(2000, audioCtx.currentTime + 0.1);
    
    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
    
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.3);
}

function addToCart(e, id) {
    // 1. Sonido
    playChiquinSound();

    // 2. Animaci√≥n Flecha
    const btn = e.target;
    const cart = document.getElementById('cartBtn');
    
    // Obtener coordenadas
    const rectBtn = btn.getBoundingClientRect();
    const rectCart = cart.getBoundingClientRect();
    
    const arrow = document.createElement('div');
    arrow.className = 'flying-arrow';
    arrow.innerHTML = '‚û§'; // Flecha
    arrow.style.left = rectBtn.left + 'px';
    arrow.style.top = rectBtn.top + 'px';
    document.body.appendChild(arrow);
    
    // Forzar reflow
    void arrow.offsetWidth;
    
    // Mover al carrito
    arrow.style.left = (rectCart.left + 10) + 'px';
    arrow.style.top = (rectCart.top + 10) + 'px';
    arrow.style.opacity = '0';
    arrow.style.transform = 'scale(0.5)';

    setTimeout(() => {
        arrow.remove();
        // Animaci√≥n peque√±a en el carrito al recibir
        cart.style.transform = 'scale(1.3)';
        setTimeout(() => cart.style.transform = 'scale(1)', 200);
    }, 600);

    // L√≥gica real de carrito (Simulada para visual)
    let current = parseInt(cart.innerText);
    cart.innerText = current + 1;
}

/* --- BUSCADOR --- */
function searchEngine(text) {
    const area = document.getElementById('contentArea');
    const term = text.toLowerCase();
    
    if(term === "") {
        renderNav(); 
        renderContent();
        document.getElementById('sectionsNav').style.display = 'flex';
        return;
    }

    document.getElementById('sectionsNav').style.display = 'none'; // Ocultar tabs al buscar

    const results = db.products.filter(p => 
        p.name.toLowerCase().includes(term) || 
        p.section.toLowerCase().includes(term)
    );

    area.innerHTML = `<div class="section-title" style="color:var(--primary)">Resultados: "${text}"</div>`;
    
    if(results.length === 0) {
        area.innerHTML += `<div style="padding:20px; text-align:center; color:#666;">No hay coincidencias.</div>`;
        return;
    }

    const grid = document.createElement('div');
    grid.className = 'grid';
    
    results.forEach(p => {
        const imgHTML = p.image ? `<img src="${p.image}">` : `<div style="height:120px; background:#222;"></div>`;
        grid.innerHTML += `
        <div class="card">
            <div style="position:absolute; bottom:0; right:0; background:rgba(0,0,0,0.8); padding:2px 5px; font-size:0.6rem;">En: ${p.section}</div>
            ${imgHTML}
            <div class="card-content">
                <h4>${p.name}</h4>
                <div class="price">$${p.price}</div>
                <button class="btn btn-main" style="margin-top:5px; font-size:0.8rem;" onclick="addToCart(event)">AGREGAR</button>
            </div>
        </div>`;
    });
    area.appendChild(grid);
}

/* --- ADMIN LOGIC --- */
function openAdmin() {
    if(localStorage.getItem('isAdmin') === 'true'){
        document.getElementById('adminPanel').classList.remove('hidden');
        updateDashboardStats();
        return;
    }
    const pass = prompt("Contrase√±a de Administrador:");
    if(pass === "separabit2020") {
        localStorage.setItem('isAdmin', 'true');
        document.getElementById('adminPanel').classList.remove('hidden');
        updateDashboardStats();
    } else { alert("Contrase√±a incorrecta"); }
}

function minimizeAdmin() {
    document.getElementById('adminPanel').classList.add('hidden');
    document.getElementById('adminTrigger').style.display = 'flex';
}

function closeAdmin(logout) {
    document.getElementById('adminPanel').classList.add('hidden');
    if(logout) {
        localStorage.removeItem('isAdmin');
        location.reload();
    }
}

let adminHistory = ['adminDashboard'];
function navTo(screenId) {
    document.querySelectorAll('.admin-section').forEach(el => el.classList.add('hidden'));
    document.getElementById(screenId).classList.remove('hidden');
    document.getElementById('adminDashboard').classList.add('hidden'); 
    adminHistory.push(screenId);
    document.getElementById('adminBackBtn').classList.remove('hidden');
    if(screenId === 'screenSections') renderAdminSections();
    if(screenId === 'screenProducts') { renderSectionSelect(); renderMiniProductList(); }
    if(screenId === 'screenCover') loadCoverValues();
    if(screenId === 'screenConfig') loadConfigValues();
}

function adminBack() {
    if(adminHistory.length > 1) {
        adminHistory.pop();
        const prev = adminHistory[adminHistory.length - 1];
        document.querySelectorAll('.admin-section').forEach(el => el.classList.add('hidden'));
        document.getElementById(prev).classList.remove('hidden');
        if(prev === 'adminDashboard') {
            document.getElementById('adminBackBtn').classList.add('hidden');
            updateDashboardStats();
        }
    }
}

function updateDashboardStats() {
    document.getElementById('statProd').innerText = db.products.length;
    document.getElementById('statSec').innerText = db.sections.length;
}

/* --- LOGICA SECCIONES --- */
function renderAdminSections() {
    const list = document.getElementById('sectionListContainer');
    list.innerHTML = "";
    db.sections.forEach((sec, index) => {
        list.innerHTML += `
        <div class="list-item">
            <span>${sec}</span>
            <div class="list-controls">
                <button onclick="moveSection(${index}, -1)">‚ñ≤</button>
                <button onclick="moveSection(${index}, 1)">‚ñº</button>
                <button onclick="deleteSection(${index})" style="color:red;">‚úñ</button>
            </div>
        </div>`;
    });
}
function addSection() {
    const name = document.getElementById('newSectionName').value;
    if(name) {
        db.sections.push(name);
        saveDB();
        renderAdminSections();
        document.getElementById('newSectionName').value = "";
    }
}
function moveSection(index, dir) {
    if(dir === -1 && index === 0) return;
    if(dir === 1 && index === db.sections.length - 1) return;
    const temp = db.sections[index];
    db.sections[index] = db.sections[index + dir];
    db.sections[index + dir] = temp;
    saveDB();
    renderAdminSections();
}
function deleteSection(index) {
    if(confirm("¬øEliminar secci√≥n?")) {
        db.sections.splice(index, 1);
        saveDB();
        renderAdminSections();
    }
}

/* --- LOGICA PRODUCTOS --- */
function renderSectionSelect() {
    const sel = document.getElementById('prodSectionSelect');
    sel.innerHTML = "";
    db.sections.forEach(s => { sel.innerHTML += `<option value="${s}">${s}</option>`; });
}

function saveProduct() {
    const name = document.getElementById('prodName').value;
    const price = document.getElementById('prodPrice').value;
    const curr = document.getElementById('prodCurrency').value;
    const sec = document.getElementById('prodSectionSelect').value;
    const desc = document.getElementById('prodDesc').value;
    const feat = document.getElementById('prodFeatured').checked;
    const fileInput = document.getElementById('prodImgInput');

    if(!name || !price) return alert("Datos incompletos");

    const newProd = { id: Date.now().toString(), name, price: parseFloat(price), currency: curr, section: sec, description: desc, featured: feat, image: null };

    if(fileInput.files && fileInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            newProd.image = e.target.result;
            finalizeSaveProd(newProd);
        };
        reader.readAsDataURL(fileInput.files[0]);
    } else { finalizeSaveProd(newProd); }
}

function finalizeSaveProd(prod) {
    db.products.push(prod);
    saveDB();
    alert("Producto Guardado");
    document.getElementById('prodName').value = "";
    document.getElementById('prodPrice').value = "";
    document.getElementById('prodImgInput').value = "";
    renderMiniProductList();
}
function renderMiniProductList() {
    const div = document.getElementById('productListMini');
    div.innerHTML = "";
    db.products.slice(-5).reverse().forEach(p => {
        div.innerHTML += `<div class="list-item"><small>${p.name} ($${p.price})</small></div>`;
    });
}

/* --- CONFIG --- */
function loadCoverValues() {
    const c = db.config;
    document.getElementById('cfgLandTitle').value = c.landingTitle;
    document.getElementById('cfgBtnText').value = c.landingBtnText;
    document.getElementById('cfgBtnStyle').value = c.landingBtnStyle;
    document.getElementById('cfgBtnAnim').value = c.landingBtnAnim;
}
function saveCoverConfig() {
    const c = db.config;
    c.landingTitle = document.getElementById('cfgLandTitle').value;
    c.landingBtnText = document.getElementById('cfgBtnText').value;
    c.landingBtnStyle = document.getElementById('cfgBtnStyle').value;
    c.landingBtnAnim = document.getElementById('cfgBtnAnim').value;
    
    const file = document.getElementById('cfgLandImg');
    if(file.files && file.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) { c.landingBg = e.target.result; saveDB(); applyConfig(); alert("Portada OK"); };
        reader.readAsDataURL(file.files[0]);
    } else { saveDB(); applyConfig(); alert("Portada OK"); }
}
function clearCoverImg() { db.config.landingBg = null; saveDB(); alert("Fondo borrado"); }

function loadConfigValues() {
    const c = db.config;
    document.getElementById('cfgAppTitle').value = c.appTitle;
    document.getElementById('cfgAppSub').value = c.appSubtitle;
    document.getElementById('cfgSubAnim').value = c.subAnim;
    document.getElementById('cfgSearchText').value = c.searchPlaceholder;
}
function saveGeneralConfig() {
    const c = db.config;
    c.appTitle = document.getElementById('cfgAppTitle').value;
    c.appSubtitle = document.getElementById('cfgAppSub').value;
    c.subAnim = document.getElementById('cfgSubAnim').value;
    c.searchPlaceholder = document.getElementById('cfgSearchText').value;
    saveDB(); applyConfig(); alert("Config OK");
}
function saveDB() { localStorage.setItem('virtud_db', JSON.stringify(db)); renderNav(); renderContent(); }

init();
</script>
</body>
</html>
