<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VIRTUD PRO V3.8</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

<style>
:root {
    --primary: #00f2ff;
    --bg: #050a10;
    --text: #ffffff;
    --accent: #ff0055;
    --success: #00ff88;
}

* { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
body { margin: 0; font-family: 'Rajdhani', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; padding-bottom: 80px; }
h1, h2, h3 { font-family: 'Orbitron', sans-serif; margin: 0; }

.hidden { display: none !important; }
.btn { border: none; padding: 10px 15px; cursor: pointer; font-family: 'Orbitron', sans-serif; font-weight: bold; text-transform: uppercase; clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px); transition: 0.2s; }
.btn-main { background: var(--primary); color: #000; width: 100%; margin-bottom: 10px; }

/* --- PORTADA ADAPTATIVA (CORREGIDO) --- */
#landing {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; flex-direction: column; justify-content: center; align-items: center;
    background-size: cover; background-position: center; z-index: 2000;
}
.landing-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.7); z-index: 1; }
.landing-content { position: relative; z-index: 2; text-align: center; padding: 20px; width: 95%; }
#landingTitle { 
    /* Ajuste flexible para t√≠tulos largos */
    font-size: clamp(1.5rem, 8vw, 3.5rem); 
    line-height: 1.2;
    word-wrap: break-word;
    text-shadow: 0 0 20px var(--primary); 
    margin-bottom: 30px; 
    max-width: 100%;
}

/* --- ESTILOS DE BOTONES --- */
.btn-neon-blue { background: linear-gradient(45deg, #00f2ff, #0044ff); color: white; box-shadow: 0 0 15px #00f2ff; }
.btn-neon-red { background: linear-gradient(45deg, #ff0055, #ff0000); color: white; box-shadow: 0 0 15px #ff0055; }
.btn-neon-green { background: linear-gradient(45deg, #00ff88, #00cc44); color: black; box-shadow: 0 0 15px #00ff88; }
.btn-neon-purple { background: linear-gradient(45deg, #aa00ff, #ff00cc); color: white; box-shadow: 0 0 15px #aa00ff; }
.btn-neon-gold { background: linear-gradient(45deg, #ffd700, #ffaa00); color: black; box-shadow: 0 0 15px #ffd700; }
.btn-neon-white { background: linear-gradient(45deg, #ffffff, #aaaaaa); color: black; box-shadow: 0 0 15px #ffffff; }
.btn-matte-black { background: #111; border: 1px solid #333; color: white; }
.btn-matte-grey { background: #444; color: white; }

/* --- ANIMACIONES --- */
.anim-pulse { animation: pulse 2s infinite; }
@keyframes pulse { 0%, 100% {transform:scale(1);} 50% {transform:scale(1.05);} }

/* --- FLECHA MEJORADA (CORREGIDO) --- */
.flying-arrow {
    position: fixed; z-index: 9999; pointer-events: none;
    font-size: 2.2rem; color: #00ff88;
    /* Efecto Glow de alta calidad */
    text-shadow: 0 0 15px #00f2ff, 0 0 30px #00f2ff;
    filter: drop-shadow(0 0 5px white);
    /* Velocidad ajustada a 1.2s */
    transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
}

/* --- APP --- */
header { background: rgba(0,0,0,0.9); padding: 15px; position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #333; text-align: center; }
.sections-nav { display: flex; overflow-x: auto; gap: 10px; padding: 15px; background: #0a0f1f; position: sticky; top: 75px; z-index: 90; scrollbar-width: none; }
.section-tab { background: #1c2541; padding: 10px 20px; border-radius: 20px; white-space: nowrap; color: #888; border: 1px solid #333; cursor: pointer; }
.section-tab.active { background: var(--primary); color: black; border: 2px solid white; box-shadow: 0 0 15px rgba(255,255,255,0.8); }

.grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; padding: 10px; }
.card { background: #151a25; border-radius: 8px; overflow: hidden; position: relative; border: 1px solid #333; }
.card img { width: 100%; height: 120px; object-fit: cover; }
.card-content { padding: 10px; }
.price { color: var(--success); font-weight: bold; }

/* --- CARRITO MODAL --- */
#cartModal {
    position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 3000;
    padding: 20px; display: flex; flex-direction: column;
}
.cart-item { display: flex; justify-content: space-between; align-items: center; background: #111; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #333; }
/* Botones + y - */
.qty-btn { background: var(--primary); border: none; width: 30px; height: 30px; font-weight: bold; cursor: pointer; }

/* --- ADMIN --- */
#adminPanel { position: fixed; inset: 0; background: #000; z-index: 5000; overflow-y: auto; display: flex; flex-direction: column; }
.admin-header { background: #111; padding: 15px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--primary); }
.list-item { background: #222; padding: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; border-radius: 5px; }

.fab-admin { position: fixed; right: 20px; top: 20px; background: rgba(0,0,0,0.5); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 500; cursor: pointer; border: 1px solid #444;}
.fab-cart { position: fixed; right: 20px; bottom: 20px; background: var(--primary); color: black; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; z-index: 400; font-weight: bold; box-shadow: 0 0 20px var(--primary);}
</style>
</head>
<body>

<div id="landing">
    <div class="landing-overlay"></div>
    <div class="landing-content">
        <h1 id="landingTitle">VIRTUD</h1>
        <button id="landingBtn" class="btn btn-neon-blue anim-pulse" style="padding: 15px 50px;" onclick="enterSite()">ENTRAR</button>
    </div>
</div>

<div class="fab-admin" onclick="openAdmin()" id="adminTrigger" style="display:none;">‚öôÔ∏è</div>

<div id="app" class="hidden">
    <header>
        <h2 id="appTitle">VIRTUD STORE</h2>
        <div id="appSubtitle" class="subtitle">Bienvenido</div>
    </header>
    <div style="padding: 15px;">
        <input type="text" id="mainSearch" placeholder="Buscar..." onkeyup="searchEngine(this.value)">
    </div>
    <div id="sectionsNav" class="sections-nav"></div>
    <div id="contentArea"></div>
</div>

<div class="fab-cart" id="cartBtn" style="display:none;" onclick="toggleCart()">0</div>

<div id="cartModal" class="hidden">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
        <h3 style="color:var(--primary); font-family:'Orbitron'">TU PEDIDO</h3>
        <button onclick="toggleCart()" style="background:none; color:white; border:none; font-size:1.5rem;">‚úï</button>
    </div>
    <div id="cartItemsList" style="flex:1; overflow-y:auto; padding-right:5px;"></div>
    
    <div style="border-top:2px solid #333; padding-top:20px; background:#050a10;">
        <h3 style="display:flex; justify-content:space-between;">
            <span>TOTAL:</span> 
            <span id="cartTotal" style="color:var(--success)">$0.00</span>
        </h3>
        <button id="btnMakeOrder" class="btn btn-main" style="margin-top:10px; height:60px; font-size:1.2rem;">HACER PEDIDO</button>
    </div>
</div>

<div id="adminPanel" class="hidden">
    <div class="admin-header">
        <button onclick="adminBack()" id="adminBackBtn" class="hidden">‚¨Ö Atr√°s</button>
        <h3 style="color:var(--primary)">ADMIN</h3>
        <button onclick="closeAdmin(true)" style="background:var(--accent); color:white; border:none;">‚úñ</button>
    </div>
    <div class="admin-body" style="padding:20px;">
        <div id="adminDashboard">
            <button class="btn btn-main" onclick="navTo('screenProducts')">üì¶ AGREGAR / ELIMINAR PRODUCTOS</button>
            <button class="btn btn-main" onclick="navTo('screenSections')">üìë SECCIONES</button>
            <button class="btn btn-main" onclick="navTo('screenCover')">üé® PORTADA</button>
            <button class="btn btn-main" onclick="navTo('screenConfig')">‚öôÔ∏è CONFIGURACIONES</button>
        </div>

        <div id="screenProducts" class="admin-section hidden">
            <h4>Nuevo Producto</h4>
            <select id="prodSectionSelect"></select>
            <input id="prodName" placeholder="Nombre">
            <input id="prodPrice" type="number" placeholder="Precio">
            <input id="prodCurrency" value="CUP">
            <input type="file" id="prodImgInput">
            <button class="btn btn-main" onclick="saveProduct()">GUARDAR</button>
            <hr style="margin:20px 0; border-color:#333;">
            <h4>Inventario Actual (Eliminar)</h4>
            <div id="fullProductList"></div>
        </div>

        <div id="screenCover" class="admin-section hidden">
            <label>T√≠tulo Portada</label>
            <input id="cfgLandTitle">
            <label>Estilo Bot√≥n</label>
            <select id="cfgBtnStyle">
                <option value="btn-neon-blue">Azul Neon</option>
                <option value="btn-neon-red">Rojo Neon</option>
                <option value="btn-neon-green">Verde Neon</option>
                <option value="btn-matte-black">Negro Mate</option>
            </select>
            <button class="btn btn-main" onclick="saveCoverConfig()">APLICAR</button>
        </div>

        <div id="screenConfig" class="admin-section hidden">
            <label>Texto Bot√≥n Carrito</label>
            <input id="cfgOrderBtnText" placeholder="Ej: HACER PEDIDO POR WHATSAPP">
            <label>Buscador Placeholder</label>
            <input id="cfgSearchText">
            <button class="btn btn-main" onclick="saveGeneralConfig()">GUARDAR</button>
        </div>

        <div id="screenSections" class="admin-section hidden">
            <input id="newSectionName" placeholder="Nueva Secci√≥n">
            <button class="btn btn-main" onclick="addSection()">A√ëADIR</button>
            <div id="sectionListContainer"></div>
        </div>
    </div>
</div>

<script>
let db = JSON.parse(localStorage.getItem('virtud_db')) || {
    config: { landingTitle: "VIRTUD", landingBtnText: "ENTRAR", landingBtnStyle: "btn-neon-blue", appTitle: "VIRTUD STORE", orderBtnText: "HACER PEDIDO", searchPlaceholder: "Buscar..." },
    sections: ["Combos", "Aseo"],
    products: []
};
let cart = [];
let activeSection = db.sections[0] || "";

// Audio System (CORREGIDO)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playChiquin() {
    // Forzar reinicio si est√° suspendido
    if (audioCtx.state === 'suspended') audioCtx.resume();
    
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.frequency.setValueAtTime(1500, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(500, audioCtx.currentTime + 0.2);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
    osc.start(); osc.stop(audioCtx.currentTime + 0.2);
}

function init() {
    document.getElementById('landingTitle').innerText = db.config.landingTitle;
    document.getElementById('landingBtn').className = "btn " + db.config.landingBtnStyle + " anim-pulse";
    document.getElementById('btnMakeOrder').innerText = db.config.orderBtnText;
    // Cargar placeholder
    document.getElementById('mainSearch').placeholder = db.config.searchPlaceholder || "Buscar...";
}

function enterSite() {
    document.getElementById('landing').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');
    document.getElementById('cartBtn').style.display = 'flex';
    document.getElementById('adminTrigger').style.display = 'flex';
    renderNav();
    renderContent();
}

function renderNav() {
    const nav = document.getElementById('sectionsNav');
    nav.innerHTML = "";
    db.sections.forEach(sec => {
        nav.innerHTML += `<div class="section-tab ${sec===activeSection?'active':''}" onclick="setActiveSection('${sec}')">${sec}</div>`;
    });
}

function setActiveSection(sec) { activeSection = sec; renderNav(); renderContent(); }

function renderContent() {
    const area = document.getElementById('contentArea');
    area.innerHTML = `<div class="grid">${db.products.filter(p => p.section === activeSection).map(p => `
        <div class="card">
            <img src="${p.image || ''}">
            <div class="card-content">
                <h4>${p.name}</h4>
                <div class="price">$${p.price}</div>
                <button class="btn btn-main" style="font-size:0.7rem;" onclick="addToCart(event, '${p.id}')">AGREGAR</button>
            </div>
        </div>`).join('')}</div>`;
}

// Buscador Estricto (CORREGIDO)
function searchEngine(val) {
    const area = document.getElementById('contentArea');
    const nav = document.getElementById('sectionsNav');
    
    if(!val) { 
        nav.classList.remove('hidden'); // Mostrar menu si no hay busqueda
        renderContent(); 
        return; 
    }
    
    // Ocultar Menu al buscar
    nav.classList.add('hidden');
    
    const res = db.products.filter(p => p.name.toLowerCase().includes(val.toLowerCase()));
    
    if(res.length === 0) {
        area.innerHTML = `<div style="text-align:center; padding:80px; color:#888;">Ese producto no se encuentra disponible.</div>`;
    } else {
        area.innerHTML = `<div class="grid">${res.map(p => `<div class="card"><img src="${p.image}"><div class="card-content"><h4>${p.name}</h4><div class="price">$${p.price}</div><button class="btn btn-main" onclick="addToCart(event, '${p.id}')">AGREGAR</button></div></div>`).join('')}</div>`;
    }
}

function addToCart(e, id) {
    playChiquin();
    const prod = db.products.find(p => p.id === id);
    const existing = cart.find(item => item.id === id);
    if(existing) existing.qty++; else cart.push({...prod, qty: 1});
    updateCartUI();

    // Animaci√≥n Flecha Mejorada (CORREGIDO)
    const rect = e.target.getBoundingClientRect();
    const cRect = document.getElementById('cartBtn').getBoundingClientRect();
    const arrow = document.createElement('div');
    arrow.className = 'flying-arrow';
    arrow.innerHTML = '‚û§';
    arrow.style.left = rect.left + 'px'; arrow.style.top = rect.top + 'px';
    document.body.appendChild(arrow);
    
    setTimeout(() => { 
        arrow.style.left = (cRect.left + 10) + 'px'; 
        arrow.style.top = (cRect.top + 10) + 'px'; 
        arrow.style.opacity = '0';
        arrow.style.transform = 'rotate(-45deg) scale(0.5)';
    }, 50);
    setTimeout(() => arrow.remove(), 1250); // Tiempo ajustado a 1.25s
}

// UI Carrito Completa (CORREGIDO)
function updateCartUI() {
    const totalQty = cart.reduce((acc, item) => acc + item.qty, 0);
    document.getElementById('cartBtn').innerText = totalQty;
    const list = document.getElementById('cartItemsList');
    let totalMoney = 0;
    
    list.innerHTML = cart.map(item => {
        totalMoney += item.price * item.qty;
        return `<div class="cart-item">
            <div style="flex:1">
                <b>${item.name}</b><br>
                <span style="color:var(--success)">$${(item.price * item.qty).toFixed(2)}</span>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <button class="qty-btn" onclick="changeQty('${item.id}', -1)">-</button>
                <span style="min-width:20px; text-align:center;">${item.qty}</span>
                <button class="qty-btn" onclick="changeQty('${item.id}', 1)">+</button>
                <button onclick="changeQty('${item.id}', -999)" style="background:none; border:none; color:red; margin-left:5px;">‚úï</button>
            </div>
        </div>`;
    }).join('');
    
    document.getElementById('cartTotal').innerText = `$${totalMoney.toFixed(2)}`;
}

// Logica de cantidad y borrado (CORREGIDO)
function changeQty(id, delta) {
    const item = cart.find(i => i.id === id);
    if (delta === -999) {
        // Borrar todo
        cart = cart.filter(i => i.id !== id);
    } else {
        item.qty += delta;
        if(item.qty <= 0) cart = cart.filter(i => i.id !== id);
    }
    updateCartUI();
}

function toggleCart() { document.getElementById('cartModal').classList.toggle('hidden'); }

// ADMIN FUNCTIONS
function openAdmin() {
    const p = prompt("Pass:");
    if(p === "separabit2020") document.getElementById('adminPanel').classList.remove('hidden');
}

function navTo(id) {
    document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
    document.getElementById('adminDashboard').classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
    document.getElementById('adminBackBtn').classList.remove('hidden');
    
    // Cargar la lista si entra a productos
    if(id === 'screenProducts') renderAdminProductList();
}

function adminBack() {
    document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
    document.getElementById('adminDashboard').classList.remove('hidden');
    document.getElementById('adminBackBtn').classList.add('hidden');
}

// Lista Admin con borrar (CORREGIDO)
function renderAdminProductList() {
    const list = document.getElementById('fullProductList');
    list.innerHTML = db.products.map(p => `
        <div class="list-item">
            <span>${p.name} ($${p.price})</span>
            <button onclick="deleteProduct('${p.id}')" style="background:var(--accent); color:white; border:none; padding:5px 10px; border-radius:3px;">ELIMINAR</button>
        </div>`).join('');
    
    const sel = document.getElementById('prodSectionSelect');
    sel.innerHTML = db.sections.map(s => `<option value="${s}">${s}</option>`).join('');
}

function deleteProduct(id) {
    if(confirm("¬øEliminar este producto?")) {
        db.products = db.products.filter(p => p.id !== id);
        saveDB();
        renderAdminProductList();
    }
}

function saveProduct() {
    const file = document.getElementById('prodImgInput').files[0];
    const reader = new FileReader();
    const newP = {
        id: Date.now().toString(),
        name: document.getElementById('prodName').value,
        price: parseFloat(document.getElementById('prodPrice').value),
        currency: document.getElementById('prodCurrency').value,
        section: document.getElementById('prodSectionSelect').value,
        image: ""
    };
    
    if(!newP.name) return alert("Pon un nombre");
    
    if(file) {
        reader.onload = (e) => { 
            newP.image = e.target.result; 
            db.products.push(newP); 
            saveDB(); 
            renderAdminProductList(); // Actualizar lista
            alert("Guardado");
        };
        reader.readAsDataURL(file);
    } else { 
        db.products.push(newP); 
        saveDB(); 
        renderAdminProductList(); 
        alert("Guardado");
    }
}

function saveCoverConfig() {
    db.config.landingTitle = document.getElementById('cfgLandTitle').value;
    db.config.landingBtnStyle = document.getElementById('cfgBtnStyle').value;
    saveDB(); location.reload();
}

function saveGeneralConfig() {
    db.config.orderBtnText = document.getElementById('cfgOrderBtnText').value || "HACER PEDIDO";
    db.config.searchPlaceholder = document.getElementById('cfgSearchText').value;
    saveDB(); location.reload();
}

function addSection() {
    db.sections.push(document.getElementById('newSectionName').value);
    saveDB(); location.reload();
}

function saveDB() { localStorage.setItem('virtud_db', JSON.stringify(db)); }
function closeAdmin() { document.getElementById('adminPanel').classList.add('hidden'); }

init();
</script>
</body>
</html>
